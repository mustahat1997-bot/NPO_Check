<!DOCTYPE html>
<html>
<head>
    <title>Automation Tool</title>
    <style>
        :root {
            --bg-color: #eef4f1;
            --card-bg: #ffffff;
            --text-color: #000000;
            --border-color: #ddd;
        }
        body.dark {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #333;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background 0.3s, color 0.3s;
        }
        .container {
            text-align: center;
            width: 650px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        hr { border: 1px solid var(--border-color); margin: 20px 0; }
        textarea, select, input[type="text"] {
            width: 100%; padding: 8px; background: var(--card-bg);
            color: var(--text-color); border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        button { padding: 8px 14px; cursor: pointer; border-radius: 4px; border: none; background-color: #4caf50; color: white; }
        button.copy-btn { background-color: #2196f3; font-size: 13px; }
        .message { margin-top: 10px; color: #4caf50; font-weight: bold; }
        .excel-file { margin-top: 4px; font-size: 13px; color: #9e9e9e; }
        .toggle { text-align: right; margin-bottom: 10px; }
        .result-box { text-align: left; background: var(--bg-color); padding: 10px; margin-top: 10px; border-radius: 4px; border: 1px solid var(--border-color); font-size: 13px; position: relative; }
        .copy-container { text-align: right; margin-bottom: 5px; }
        .notification { display: none; background: #4caf50; color: white; padding: 6px 10px; border-radius: 4px; font-size: 12px; position: absolute; top: 10px; right: 10px; }
    
        .special-note {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border-left: 6px solid #ff9800;
            padding: 16px;
            border-radius: 10px;
            text-align: left;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            animation: fadeIn 0.4s ease-in-out;
        }

        .note-title {
            font-weight: bold;
            font-size: 15px;
            margin-bottom: 6px;
            color: #e65100;
        }

        .note-body {
            font-size: 14px;
            color: #5d4037;
            line-height: 1.6;
        }

        .special-note strong {
            font-weight: bold;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body>

<div class="container">

    <div class="toggle">
        <label><input type="checkbox" id="darkToggle"> üåô Dark Mode</label>
    </div>

    <h2>Update Database</h2>
    <form method="post">
        <button name="action" value="update_db">üîÑ Update from Excel</button>
        {% if message %}
            <div class="message">{{ message }}</div>
        {% endif %}
        {% if excel_file %}
            <div class="excel-file">{{ excel_file }}</div>
        {% endif %}
    </form>

    <hr>

    <h2>Step 1: Get Actions</h2>
    <form method="post">
        <textarea name="points" rows="4" placeholder="Enter POINT(s) each in new line"></textarea>
        <br><br>
        <button name="action" value="get_actions">Get Actions</button>
    </form>

    {% if point_result %}
    <div class="result-box">
        <div class="copy-container">
            <button type="button" class="copy-btn" onclick="copyResults()">üìã Copy</button>
        </div>
        <div class="notification" id="copyNote">Copied ‚úÖ</div>
        <div id="resultsContent">
            {% for item in point_result %}
                <hr>
                <p><strong>POINT:</strong> {{ item.point }}</p>

                {% if item.not_found %}
                    <p style="color:red;"><strong>Point not found</strong></p>
                {% else %}
                    <p><strong>REPEATER:</strong> {{ item.repeater }}</p>
                    <p><strong>Province:</strong> {{ item.province }}</p>
                    <p><strong>Q Action:</strong> {{ item.q_action }}</p>
                    <p><strong>R Action:</strong> {{ item.r_action }}</p>
                    <p><strong>Q Action Repeater:</strong> {{ item.q_action_repeater }}</p>
                {% endif %}
            {% endfor %}

        </div>
    </div>
    {% endif %}

    <hr>

    <h2>Step 2: Apply Rule</h2>
    <form method="post">
        {% if show_special_note %}
        <div class="special-note">
            <div class="note-title">
                ‚ö†Ô∏è Important Notice
            </div>
            <div class="note-body">
                You should use the rule <strong>(+80%) International</strong><br>
                for the points located in <strong>Najaf D.C</strong> and <strong>Basrah D.C</strong>.
            </div>
        </div>
        <br>
        {% endif %}

        <!-- ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ÿ®ÿπÿØ ÿßŸÑÿ¢ŸÜ -->
        <select name="rule">
            <option value="(+80%) International & Local CDN 100%">(+80%) International & Local CDN 100%</option>
            <option value="(+80%) International">(+80%) International</option>
            <option value="150% Int. & 150% Local & 60% Bag CDN">150% Int. & 150% Local & 60% Bag CDN</option>
            <option value="(+100%) All">(+100%) All</option>
            <option value="(+100%) International & Local CDN 100%">(+100%) International & Local CDN 100%</option>
            <option value="(+1000%) All">(+1000%) All</option>
            <option value="80% Int. & 100% Local & 60% Bag CDN">80% Int. & 100% Local & 60% Bag CDN</option>
            <option value="(-50%) & 0.1 Share without BGD-CDN">(-50%) & 0.1 Share without BGD-CDN</option>
            <option value="(-50%) without BGD-CDN">(-50%) without BGD-CDN</option>
            <option value="(-80%) & 0.1 Share without BGD-CDN">(-80%) & 0.1 Share without BGD-CDN</option>
            <option value="Faw Rule">Faw Rule</option>
        </select>
        <br><br>
        <button name="action" value="apply_rule">Apply Rule & Generate Excel</button>
    </form>

</div>

<script>
    const toggle = document.getElementById("darkToggle");
    if (localStorage.getItem("darkMode") === "on") {
        document.body.classList.add("dark");
        toggle.checked = true;
    }
    toggle.addEventListener("change", function () {
        if (this.checked) {
            document.body.classList.add("dark");
            localStorage.setItem("darkMode", "on");
        } else {
            document.body.classList.remove("dark");
            localStorage.setItem("darkMode", "off");
        }
    });

    function copyResults() {
    let items = document.querySelectorAll("#resultsContent p");
    let finalText = "";
    let group = [];

    items.forEach((p, index) => {
        group.push(p.innerText);

        // ŸÉŸÑ POINT Ÿäÿ≠ÿ™ŸàŸä 6 ÿπŸÜÿßÿµÿ±
        if ((index + 1) % 6 === 0) {
            finalText += group.join("\n") +
                "\n-------------------------------------------------------------------------------\n";
            group = [];
        }
    });

    finalText = finalText.trim();

    let textarea = document.createElement("textarea");
    textarea.value = finalText;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand("copy");
    document.body.removeChild(textarea);

    let note = document.getElementById("copyNote");
    note.style.display = "block";
    setTimeout(() => { note.style.display = "none"; }, 1500);
}
</script>

</body>
</html>
